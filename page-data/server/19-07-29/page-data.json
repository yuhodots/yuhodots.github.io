{"componentChunkName":"component---src-templates-post-js","path":"/server/19-07-29/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>이 글은 ‘오픈튜토리얼스-생활코딩’의 egoing님 <a href=\":https://www.opentutorials.org/course/2717/11344\">강의</a>를 정리했음을 먼저 밝힙니다.</p>\n</blockquote>\n<p> S3는 아마존 웹 서비스에서 제공하는 서비스 중 하나입니다. 풀어서 보면 Simplet Sotrage Service라는 의미를 가지고 있습니다. 즉, 어떠한 정보를 저장하는 서비스라는 말인데 그냥 쉽게 생각하면 파일을 저장하는 서비스라고 말할 수 있습니다. 물론 서버 컴퓨터에 파일을 직접 저장하는 방법도 있지만, S3를 사용하면 아주 많은 것들을 신경 쓰지 않고도 많은 양의 파일을 아주 안전하게 보관할 수 있다는 장점이 있습니다.</p>\n<h3 id=\"s3를-사용하는-이유\" style=\"position:relative;\"><a href=\"#s3%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"s3를 사용하는 이유 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S3를 사용하는 이유</h3>\n<ul>\n<li><strong>내구성</strong>: S3는 중요한 데이터를 저장 할 수 있고, 99.999999999%의 객체 내구성을 보장합니다. 데이터가 여러 시설과 각 시설의 여러 디바이스에 중복 저장됩니다. </li>\n<li><strong>저렴한 비용</strong>: S3를 사용하면 매우 저렴한 비용으로 대용량의 데이터를 저장할 수 있습니다. 사용하는 만큼 비용을 지불하면 되기 때문에 서비스의 비용 진입 장벽이 낮다고 말할 수 있습니다. 또한 접근 빈도에 따라 다른 방법으로 저장하여 비용을 절약합니다.</li>\n<li><strong>보안</strong>: SSL을 통한 데이터 전송과 데이터 업로드 후 자동 암호화를 지원합니다. </li>\n<li><strong>확장 가능</strong>: S3의 서버가 마비되거나 죽을 것이라는 걱정을 할 필요가 없어집니다.</li>\n<li><strong>이벤트 알림 전송</strong>: 다른 서비스의 트리거 역할로도 활용이 가능합니다. </li>\n</ul>\n<p> 위의 장점들 때문에 S3를 사용하며, 이와 더불어 S3를 사용하면 생기는 이점에는 콘텐츠 저장 및 배포, 빅 데이터 분석, 그리고 재해 복구 등이 있습니다. </p>\n<h3 id=\"기본-조작\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%EC%A1%B0%EC%9E%91\" aria-label=\"기본 조작 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 조작</h3>\n<p> 아마존 웹 서비스 콘솔에서 S3를 조작 해 봅시다. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4bf225284e5d9dc19c9c26570c1470df/21b4d/19-07-29-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQY042OTUvDQBCG8/8PLYi3xFiqxEaw0V/gXTwJevUkSG2bNdnvzfZxu3oRLw48w/u+zAxTDMNIjBOPT8/MyiXVqqO6WnN2ZLWmTr5uOxbXd5y3t1mXzQ2nTcfJomVeXiSWzKpL5nVDIZVKByPHOkwBguG/dUiPpJ51/MkKIQRKyWzexRv3Lw/04wfWOIwxWGtxzhNC+IVPGGP5HIa0r9Ba56yQcmSzE1gfkU7xutuwlYq98gmX6bWnN+EPIrHX33Nb6dB+4gvy2CZjiNkcVwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4bf225284e5d9dc19c9c26570c1470df/15813/19-07-29-1.webp 190w,\n/static/4bf225284e5d9dc19c9c26570c1470df/1cdb2/19-07-29-1.webp 380w,\n/static/4bf225284e5d9dc19c9c26570c1470df/9046c/19-07-29-1.webp 760w,\n/static/4bf225284e5d9dc19c9c26570c1470df/c89f9/19-07-29-1.webp 1140w,\n/static/4bf225284e5d9dc19c9c26570c1470df/af3f0/19-07-29-1.webp 1280w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4bf225284e5d9dc19c9c26570c1470df/a2d4f/19-07-29-1.png 190w,\n/static/4bf225284e5d9dc19c9c26570c1470df/3f520/19-07-29-1.png 380w,\n/static/4bf225284e5d9dc19c9c26570c1470df/3c051/19-07-29-1.png 760w,\n/static/4bf225284e5d9dc19c9c26570c1470df/b5cea/19-07-29-1.png 1140w,\n/static/4bf225284e5d9dc19c9c26570c1470df/21b4d/19-07-29-1.png 1280w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4bf225284e5d9dc19c9c26570c1470df/3c051/19-07-29-1.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p> S3 콘솔에서 버킷만들기를 클릭하여 버킷을 생성합니다. '버킷'은 파일을 저장할 수 있는 공간 또는 저장 장치라고 생각하시면 됩니다. 여기서 주의할 점은 aws내 전체의 버킷과 중복되지 않는 고유 DNS 호환 이름을 설정해야 합니다. 자 그러면 아래와 같이 버킷이 생성되고 우리는 이 버킷에 파일을 업로드 할 수 있게 됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/341cf01809f5fa3b14a29693aed08347/21b4d/19-07-29-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.31578947368421%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3klEQVQY05WOwWvCMBTG+/8fxw52h4EobigMdvPqTcSLlx08DGG2SJOqaZO0SZN8e9EqngYL/PK9F9778iVd18EaAyBg+73D8/AdL28fSMczDEZTpJNrnY6nl/en1wkWyzWcd5BaQzfNHUUkq53A/Ivjc8OwPUiE4CGNx18nBMA5D0+FbloUjOEsKlgKl5y0RSZa5ERRG5TKgquohOy1r7lsiWt/pL1H4p6yDok0DkzdjCwYLUTyY42srJCR5idJWuGHC+xLQX19n7sRw9QtJYxXEX/vzXhv/F+iRwz3C6Y9d/dj0lNFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/341cf01809f5fa3b14a29693aed08347/15813/19-07-29-2.webp 190w,\n/static/341cf01809f5fa3b14a29693aed08347/1cdb2/19-07-29-2.webp 380w,\n/static/341cf01809f5fa3b14a29693aed08347/9046c/19-07-29-2.webp 760w,\n/static/341cf01809f5fa3b14a29693aed08347/c89f9/19-07-29-2.webp 1140w,\n/static/341cf01809f5fa3b14a29693aed08347/af3f0/19-07-29-2.webp 1280w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/341cf01809f5fa3b14a29693aed08347/a2d4f/19-07-29-2.png 190w,\n/static/341cf01809f5fa3b14a29693aed08347/3f520/19-07-29-2.png 380w,\n/static/341cf01809f5fa3b14a29693aed08347/3c051/19-07-29-2.png 760w,\n/static/341cf01809f5fa3b14a29693aed08347/b5cea/19-07-29-2.png 1140w,\n/static/341cf01809f5fa3b14a29693aed08347/21b4d/19-07-29-2.png 1280w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/341cf01809f5fa3b14a29693aed08347/3c051/19-07-29-2.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/386b9e35ee82a69e50c67ed8d51a7d13/b0f48/19-07-29-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.05263157894737%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcElEQVQY03XPW0sbYRCH8f2AHtAKjVjwzjZatbVFkihVA1rwGGOuNbYeUqMiXhQpgm0MgWpBi4KoeIjGBBPXbHaN0d1kn768F0VEB378h7kYZhTTMjHv7wGbg5M4w+Mz+L+G8U+GGJ2YxfdlDl8whE/0ATH3jAUZWY6ymTSIHF8RPVH5Hb+WNgQlly+Q0QxJ1XSutZyU1TRyuk7+tiAZ+Vuw7vh+qNIaSeOKqTh/pGhYSVIWjlM+H6dy4QxlI2GwvKcS3s3wN2VgWkUKZlFcXJJXP67IfgLPt5/0Lq7jDf+iY3aNF4GV/xT1psBpOsuFlieRvREpPEzhXNU5SmbQ7oosrcWoeuumptlDdZOLl+86cbS4cTS7ZCp/EjpT25eEdjIEty6fkGZS5PR2ioV9nf7FiFzmeP+Jpp5BWrxD1H3o5tXHHmrbulBs26ZUKkm2/TzLsuTLq7FNKpzt1IqFzu4BXvf6efM5QGPfGPXuPv4BeoiMgEhMfsoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/386b9e35ee82a69e50c67ed8d51a7d13/15813/19-07-29-3.webp 190w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/1cdb2/19-07-29-3.webp 380w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/9046c/19-07-29-3.webp 760w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/c89f9/19-07-29-3.webp 1140w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/7afe4/19-07-29-3.webp 1520w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/205ae/19-07-29-3.webp 2690w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/386b9e35ee82a69e50c67ed8d51a7d13/a2d4f/19-07-29-3.png 190w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/3f520/19-07-29-3.png 380w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/3c051/19-07-29-3.png 760w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/b5cea/19-07-29-3.png 1140w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/891d5/19-07-29-3.png 1520w,\n/static/386b9e35ee82a69e50c67ed8d51a7d13/b0f48/19-07-29-3.png 2690w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/386b9e35ee82a69e50c67ed8d51a7d13/3c051/19-07-29-3.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p> 위 처럼 업로드 버튼을 눌러 파일을 업로드 할 수도 있지만, 서버 내 미들웨어가 사용자의 요청을 받아 S3에 저장하도록 지시하는 방법 또한 사용이 가능합니다. 그리고 그 파일에 대한 정보는 S3 내에서 url링크의 형태로도 확인이 가능합니다.</p>\n<h3 id=\"업로드\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\"업로드 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>업로드</h3>\n<p> 먼저 AWS SDK를 모듈의 형태로 가져오고 지역 설정을 서울(ap-northeast-2)로 설정하겠습니다. Express에 내장되어있는 File System(fs) 모듈 또한 필요하기 때문에 미리 로드 해 주었습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aws-sdk'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">AWS</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>region <span class=\"token operator\">=</span> <span class=\"token string\">'ap-northeast-2'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 그리고 아래와 같이 코드를 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> s3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>S3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> param <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'Bucket'</span><span class=\"token operator\">:</span><span class=\"token string\">'example.net'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Key'</span><span class=\"token operator\">:</span><span class=\"token string\">'exp.png'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'ACL'</span><span class=\"token operator\">:</span><span class=\"token string\">'public-read'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Body'</span><span class=\"token operator\">:</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bigfile.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'ContentType'</span><span class=\"token operator\">:</span><span class=\"token string\">'image/png'</span>\n<span class=\"token punctuation\">}</span>\ns3<span class=\"token punctuation\">.</span><span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><strong>Bucket</strong>: 사용할 S3 버킷의 이름을 작성합니다.</li>\n<li><strong>key</strong>: S3에 저장 될 파일의 이름을 작성합니다.</li>\n<li><strong>ACL</strong>: 소유자만 쓰기가 가능하지만, 모든 사람이 읽을 수 있도록 public-read 권한 설정을 하였습니다.</li>\n<li><strong>Body</strong>: 전송하는 방법에 대한 부분입니다. </li>\n<li><strong>ContentType</strong>: 업로드한 파일의 타입을 정의합니다. </li>\n</ul>\n<p> Body파트는 Buffer, String_value, streamObject 세 가지 방법 중 하나를 선택하면 되는데 이 중 streamObject가 권장되는 방법입니다. 그래서 위 처럼 fs모듈 내 <code class=\"language-text\">createReadStream</code> 함수를 호출해서 bigfile이라는 파일을 조각조각 내서 담는 것을 실행한 뒤에, 이를 S3에 무리없이 전송하게 됩니다. </p>\n<p>파일 업로드 메소드에는 <code class=\"language-text\">upload</code>뿐 아니라 <code class=\"language-text\">putObject</code>라는 메소드 또한 존재합니다. 하지만 <code class=\"language-text\">putObject</code> 메소드에는 업로드 된 파일의 주소가 data에 담기지 않기 때문에, 이 주소가 필요 할 때에는 위 처럼 <code class=\"language-text\">upload</code>메소드를 사용 해 주시면 됩니다. </p>\n<h3 id=\"목록\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%EB%A1%9D\" aria-label=\"목록 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목록</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">s3<span class=\"token punctuation\">.</span><span class=\"token function\">listObjects</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>Bucket<span class=\"token operator\">:</span> <span class=\"token string\">'example.net'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handlePage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> name <span class=\"token keyword\">in</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>Contents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>Contents<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">hasNextPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">nextPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span> handlePage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 위의 코드는 S3내 파일의 이름을 콘솔에 표시하는 소스코드입니다. 하나하나 살펴보도록 합시다.  </p>\n<p> 일단 <code class=\"language-text\">listObjects</code> 메소드를 사용하고, 인자로는 자신이 사용할 버킷을 객체의 형태로 전달 해 줍니다. (저는 example.net이라는 버킷을 사용한다고 가정하였습니다.) 그리고 <strong>이벤트 방식</strong>인 <code class=\"language-text\">.on(&#39;success&#39;, function ...)</code> 형태의 코드를 작성합니다. 이는 <code class=\"language-text\">listObjects</code> 메소드를 통해 정보를 가져오는데 성공했다면 <strong>success 뒤의 콜백함수를 실행</strong>한다는 의미입니다. </p>\n<p> 그리고 정보를 한 번에 모두 가져오면 너무 많은 양이 한 번에 유입 될 수도 있기 때문에 페이징을 통해 순차적으로 정보를 가져오는데, 먼저 <code class=\"language-text\">response.hasNextPage()</code>를 통해 다음 페이지에 정보가 있는지 확인하고 정보가 있다면 <code class=\"language-text\">response.nextPage().on(&#39;success&#39;, handlePage).send()</code>를 통해 다음 페이지의 정보를 가져옵니다. 근데 여기서 인자로 <code class=\"language-text\">handlePage</code> 그 자체를 주었기 때문에 이는 <strong>재귀함수</strong>의 형태를 띄고 있다는 것을 알 수 있습니다. </p>\n<p> 마지막으로 <code class=\"language-text\">response.data.Contents</code>는 S3에 업로드 한 파일의 정보가 담기는 곳입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06d4c7ffcd5f8f247b8642237120cf78/21b4d/19-07-29-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.421052631578945%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVQY031R2W6EQAzjKEdZWO4BhvtaYFW1D1X7/3/mJoN43D5YjqKJx060ZV4xjzOe+xPLtCBPc4VGNhB5gUKUKAkF1XGUwPd86Jr+Etq27piGGcd2qKGxH1GTWFVUCnVVIwojWG8WTMM8hzTtNR7LRoLTKVBKfH58QRJ77x5u5CbwA9yDENE9QkIO2WWWZEgJIhfE6ek+jGFbNgmuG/q2V5HZHcdrm07Vbd0q7rsBHfX402vQsV24jkvsKOaeqZuX4ADmPBM02ENWEhntUbmgnn/zYejG/1Ev7I8DI0VmZyz28/2rXCVxgjRO1YFEVqgD8Rv+gCMyeDXc5z3zW3b9B6AxkaqaRGheAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/06d4c7ffcd5f8f247b8642237120cf78/15813/19-07-29-4.webp 190w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/1cdb2/19-07-29-4.webp 380w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/9046c/19-07-29-4.webp 760w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/c89f9/19-07-29-4.webp 1140w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/af3f0/19-07-29-4.webp 1280w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/06d4c7ffcd5f8f247b8642237120cf78/a2d4f/19-07-29-4.png 190w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/3f520/19-07-29-4.png 380w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/3c051/19-07-29-4.png 760w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/b5cea/19-07-29-4.png 1140w,\n/static/06d4c7ffcd5f8f247b8642237120cf78/21b4d/19-07-29-4.png 1280w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/06d4c7ffcd5f8f247b8642237120cf78/3c051/19-07-29-4.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><code class=\"language-text\">response.data.Contents</code> 에는 우리가 S3에 업로드 한 파일의 정보가 객체의 형태로 담겨있기 때문에 나중에 이를 웹 애플리케이션에 유용하게 적용 가능합니다. </p>\n<h3 id=\"다운로드\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C\" aria-label=\"다운로드 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다운로드</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> file <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'logo.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>Bucket<span class=\"token operator\">:</span><span class=\"token string\">'example.net'</span><span class=\"token punctuation\">,</span> Key<span class=\"token operator\">:</span><span class=\"token string\">'logo.png'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\ns3<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 기본적인 다운로드 방법으로는 Streaming requests 방법이 있습니다. 앞서 언급했듯이 데이터를 우리가 사용할 때 이 데이터의 용량이 굉장히 크면 우리의 컴퓨터가 마비가 될 우려가 있습니다. 때문에 파일을 통째로 사용하기 보다는 부분 부분 사용하는 것이 안정적이고 효율적이기 때문에 이 때 사용하는 방법이 Streaming 입니다. </p>\n<p> 우리는 현재 S3에 있는 정보를 읽어서, 그 읽은 정보를 우리의 컴퓨터 안에 다운로드 혹은 write 하는 중입니다. 그렇기 때문에 <code class=\"language-text\">createWriteStream</code>의 입력값으로 우리가 다운로드 받고 싶은 파일 이름을 넣어주고 file이라는 변수에 담아줍니다. 그리고 우리가 S3에서 읽어올 정보를 params에 담아 <code class=\"language-text\">s3.getObject(params).createReadStream()</code>로 읽어주고 이를 <code class=\"language-text\">pipe(file)</code>로 연결해줍니다. </p>\n<h3 id=\"활용하기\" style=\"position:relative;\"><a href=\"#%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"활용하기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>활용하기</h3>\n<p>Nodejs에 S3를 활용하기 위해서 일단 아래와 같이 필요한 모듈을 로드 해 줍시다. Express에 기본적으로 파일 업로드에 대한 기능이 내장되어 있지 않기 때문에 이를 구현하기 위해 <strong>formidable</strong>이라는 모듈을 로드 해 주었습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> formidable <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'formidable'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aws-sdk'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">AWS</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>region <span class=\"token operator\">=</span> <span class=\"token string\">'ap-northeast-2'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 그리고 파일을 업로드 하기 위한 form을 만들어 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/form'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> output <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n&lt;html>\n&lt;body>\n    &lt;form enctype=\"multipart/form-data\" method=\"post\" action=\"upload_receiver\">\n        &lt;input type=\"file\" name=\"userfile\">\n        &lt;input type=\"submit\">\n    &lt;/form>\n&lt;/body>\n&lt;/html>\n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> upload_receiver라는 경로로 post방식으로 파일을 전송하였으니 이번에는 받는 쪽 코드를 아래에 작성하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/upload_receiver'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">var</span> form <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">formidable<span class=\"token punctuation\">.</span>IncomingForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   form<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> fields<span class=\"token punctuation\">,</span> files</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n       <span class=\"token keyword\">var</span> s3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>S3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            Bucket<span class=\"token operator\">:</span><span class=\"token string\">'example.net'</span><span class=\"token punctuation\">,</span>\n            Key<span class=\"token operator\">:</span>files<span class=\"token punctuation\">.</span>userfile<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">ACL</span><span class=\"token operator\">:</span><span class=\"token string\">'public-read'</span><span class=\"token punctuation\">,</span>\n            Body<span class=\"token operator\">:</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span>files<span class=\"token punctuation\">.</span>userfile<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span>\n       <span class=\"token punctuation\">}</span>\n       s3<span class=\"token punctuation\">.</span><span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> result<span class=\"token operator\">=</span><span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n                result <span class=\"token operator\">=</span> <span class=\"token string\">'Fail'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">else</span>\n                result <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;img src=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token punctuation\">.</span>Location<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;html>&lt;body></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>result<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/body>&lt;/html></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 전체 코드는 <a href=\"https://www.opentutorials.org/course/2717/11797\">여기</a>에 있습니다. 코드를 실행 했을 때 S3서버 컴퓨터에 잘 업로드가 된다면 성공입니다 😊</p>","tableOfContents":"<ul>\n<li><a href=\"/Web/19-07-29-Node.js%EC%97%90%EC%84%9C%EC%9D%98%20S3%20SDK%20%EC%82%AC%EC%9A%A9md/#s3%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\">S3를 사용하는 이유</a></li>\n<li><a href=\"/Web/19-07-29-Node.js%EC%97%90%EC%84%9C%EC%9D%98%20S3%20SDK%20%EC%82%AC%EC%9A%A9md/#%EA%B8%B0%EB%B3%B8-%EC%A1%B0%EC%9E%91\">기본 조작</a></li>\n<li><a href=\"/Web/19-07-29-Node.js%EC%97%90%EC%84%9C%EC%9D%98%20S3%20SDK%20%EC%82%AC%EC%9A%A9md/#%EC%97%85%EB%A1%9C%EB%93%9C\">업로드</a></li>\n<li><a href=\"/Web/19-07-29-Node.js%EC%97%90%EC%84%9C%EC%9D%98%20S3%20SDK%20%EC%82%AC%EC%9A%A9md/#%EB%AA%A9%EB%A1%9D\">목록</a></li>\n<li><a href=\"/Web/19-07-29-Node.js%EC%97%90%EC%84%9C%EC%9D%98%20S3%20SDK%20%EC%82%AC%EC%9A%A9md/#%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C\">다운로드</a></li>\n<li><a href=\"/Web/19-07-29-Node.js%EC%97%90%EC%84%9C%EC%9D%98%20S3%20SDK%20%EC%82%AC%EC%9A%A9md/#%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0\">활용하기</a></li>\n</ul>","frontmatter":{"path":"/server/19-07-29/","title":"Node.js에서의 S3 SDK 사용","category":"Server","date":"2019-07-29"}}},"pageContext":{}},"staticQueryHashes":["2390655019","256249292","63159454"]}